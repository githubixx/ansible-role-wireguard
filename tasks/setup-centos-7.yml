---
# Copyright (C) 2020 Roman Danko
# SPDX-License-Identifier: GPL-3.0-or-later

- name: (CentOS 7) Install EPEL repository & yum utils
  yum:
    name:
      - epel-release
      - yum-utils
    update_cache: true

- name: (CentOS 7) Enable CentosPlus repo
  command: "yum-config-manager"
  args:
    stdin: "--setopt=centosplus.includepkgs=kernel-plus --enablerepo=centosplus --save"
  changed_when: false

- name: (CentOS 7) Update to kernel-plus
  ansible.builtin.replace:
    path: /etc/sysconfig/kernel
    regexp: '^DEFAULTKERNEL=kernel$'
    replace: 'DEFAULTKERNEL=kernel-plus'

- name: (CentOS 7) Ensure WireGuard DKMS package is removed
  yum:
    name:
      - "wireguard-dkms"
    state: absent

- name: (CentOS 7) Install WireGuard packages
  yum:
    name:
      - "kernel-plus"
      - "wireguard-tools"
    state: present
