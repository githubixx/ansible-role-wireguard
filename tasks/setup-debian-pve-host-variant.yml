---
# Copyright (C) 2018-2025 Robert Wimmer
# Copyright (C) 2019-2025 Ties de Kock
# Copyright (C) 2021-2025 Steve Fan
# SPDX-License-Identifier: GPL-3.0-or-later

- name: (Proxmox) Add WireGuard repository
  ansible.builtin.apt_repository:
    repo: "deb http://deb.debian.org/debian buster-backports main"
    state: present
    update_cache: "{{ wireguard_update_cache }}"
  when: ansible_facts['distribution_version'] | int <= 10

- name: (Proxmox) Install kernel headers for the currently running kernel to compile WireGuard with DKMS
  ansible.builtin.apt:
    name:
      - "pve-headers-{{ ansible_facts['kernel'] }}"
    state: present
  when: ansible_facts['distribution_version'] | int <= 10

- name: (Proxmox) Install WireGuard packages
  ansible.builtin.apt:
    name:
      - "wireguard"
    state: present
  when: ansible_facts['distribution_version'] | int <= 10

- name: (Proxmox) Install WireGuard tools
  ansible.builtin.apt:
    name:
      - "wireguard-tools"
    state: present
    install_recommends: false
  when: ansible_facts['distribution_version'] | int > 10
